---
import BaseLayout from '@/layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

// 모든 태그 수집
const posts = await getCollection('posts', ({ data }) => {
  return data.draft !== true;
});

const tagCounts = new Map<string, number>();

posts.forEach(post => {
  post.data.tags?.forEach(tag => {
    tagCounts.set(tag, (tagCounts.get(tag) || 0) + 1);
  });
});

// 태그를 빈도순으로 정렬
const sortedTags = Array.from(tagCounts.entries())
  .sort((a, b) => b[1] - a[1]);
---

<BaseLayout title="태그" description="모든 태그를 확인하세요">
  <div class="container mx-auto px-4 py-12">
    <!-- 헤더 -->
    <div class="mb-12 text-center">
      <h1 class="text-4xl font-bold tracking-tight">태그</h1>
      <p class="mt-4 text-lg text-muted-foreground">
        총 {sortedTags.length}개의 태그가 있습니다
      </p>
    </div>

    <!-- 태그 클라우드 -->
    {sortedTags.length > 0 ? (
      <div class="flex flex-wrap justify-center gap-4">
        {sortedTags.map(([tag, count]) => (
          <a
            href={`/tags/${tag}`}
            class="group relative inline-flex items-center gap-2 rounded-full bg-secondary px-4 py-2 text-secondary-foreground transition-all hover:bg-secondary/80 hover:scale-105"
          >
            <span class="text-sm font-medium">#{tag}</span>
            <span class="inline-flex h-5 min-w-5 items-center justify-center rounded-full bg-primary/10 px-1.5 text-xs font-semibold text-primary">
              {count}
            </span>
          </a>
        ))}
      </div>
    ) : (
      <div class="rounded-lg border border-dashed p-12 text-center">
        <p class="text-muted-foreground">
          아직 태그가 없습니다.
        </p>
      </div>
    )}
  </div>
</BaseLayout>